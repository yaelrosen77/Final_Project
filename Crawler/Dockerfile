FROM python:3.10-slim

# П 转拽转 转转 注专转
RUN apt-get update && apt-get install -y \
    wget curl gnupg unzip sudo \
    tshark \
    libnss3 libatk-bridge2.0-0 libgtk-3-0 libxss1 libasound2 \
    libappindicator3-1 libu2f-udev xdg-utils fonts-liberation \
    libvulkan1 libxshmfence1 libdrm2 \
    chromium \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

#  转拽转 注
WORKDIR /app

#  注转拽转 拽爪
COPY . .

#  转拽转 转转 驻转
RUN pip install --no-cache-dir \
    pandas \
    openpyxl \
    tldextract \
    selenium \
    undetected-chromedriver==3.5.4 \
    playwright

# З 转拽转 驻驻 -Playwright
RUN playwright install --with-deps

#  专砖转 -tshark 专爪 转 拽专
RUN adduser --disabled-password --gecos '' tshark && \
    chgrp tshark /usr/bin/dumpcap && \
    chmod 750 /usr/bin/dumpcap && \
    setcap cap_net_raw,cap_net_admin=eip /usr/bin/dumpcap

#  专专转 : 专抓 转 住驻专 专砖
ENV PYTHONUNBUFFERED=1
CMD ["python", "ApplicationRunner.py"]
